{% extends 'base.html' %}
{% load static %}

{% block title %}Reception Billing - Appointment{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="bi bi-cash-stack"></i> Reception Billing - Appointment</h4>
                </div>
                <div class="card-body">
                    <!-- Appointment Details -->
                    <div class="alert {% if appointment.is_online_booking %}alert-warning{% else %}alert-info{% endif %}">
                        <h5>Appointment: {{ appointment.appointment_number }}</h5>
                        {% if appointment.is_online_booking %}
                        <div class="badge bg-warning text-dark mb-2">
                            <i class="bi bi-globe"></i> ONLINE BOOKING - NOT PAID
                        </div>
                        {% endif %}
                        <p class="mb-0">
                            <strong>Patient:</strong> {{ appointment.patient.get_full_name }} ({{ appointment.patient.patient_id }})<br>
                            <strong>Doctor:</strong> Dr. {{ appointment.doctor.get_full_name }}<br>
                            <strong>Serial:</strong> #{{ appointment.serial_number }}<br>
                            <strong>Date:</strong> {{ appointment.appointment_date|date:"d M Y" }}
                            {% if appointment.is_online_booking %}
                                <br><strong>Type:</strong> <span class="badge bg-warning text-dark">Online Appointment</span>
                            {% endif %}
                        </p>
                    </div>

                    <!-- Consultation Fee -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5>Consultation Fee: ৳{{ appointment.consultation_fee }}</h5>
                        </div>
                    </div>

                    <!-- Billing Form -->
                    <form method="post" id="billingForm">
                        {% csrf_token %}
                        
                        <hr>

                        <!-- PC Code Section - DISABLED FOR DOCTOR APPOINTMENTS -->
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>Note:</strong> PC codes are only for lab tests, not doctor consultations.
                        </div>

                        <!-- Final Amount -->
                        <div class="alert alert-primary">
                            <h4 class="mb-0">
                                <strong>Final Amount to Pay: ৳{{ appointment.consultation_fee }}</strong>
                            </h4>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-check-circle-fill"></i> Confirm Payment & Mark as Paid
                            </button>
                            <a href="{% url 'appointments:appointment_detail' appointment.id %}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('billingForm').addEventListener('submit', function(e) {
    return confirm('Confirm payment of ৳{{ appointment.consultation_fee }}?');
});
</script>

{% endblock %}

